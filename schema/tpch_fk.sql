USE TPCH;
GO

ALTER TABLE REGION ALTER COLUMN R_REGIONKEY INT NOT NULL;
GO
ALTER TABLE REGION ADD PRIMARY KEY (R_REGIONKEY);

ALTER TABLE NATION ALTER COLUMN N_NATIONKEY INT NOT NULL;
GO
ALTER TABLE NATION ADD PRIMARY KEY (N_NATIONKEY);


ALTER TABLE NATION
ADD CONSTRAINT NATION_FK1 FOREIGN KEY (N_REGIONKEY) REFERENCES REGION(R_REGIONKEY);

ALTER TABLE PART ALTER COLUMN P_PARTKEY INT NOT NULL;
GO
ALTER TABLE PART ADD PRIMARY KEY (P_PARTKEY);

ALTER TABLE SUPPLIER ALTER COLUMN S_SUPPKEY INT NOT NULL;
GO
ALTER TABLE SUPPLIER ADD PRIMARY KEY (S_SUPPKEY);

ALTER TABLE SUPPLIER
ADD CONSTRAINT SUPPLIER_FK1 FOREIGN KEY (S_NATIONKEY) REFERENCES NATION(N_NATIONKEY);

ALTER TABLE PARTSUPP ALTER COLUMN PS_PARTKEY INT NOT NULL;
ALTER TABLE PARTSUPP ALTER COLUMN PS_SUPPKEY INT NOT NULL;
GO
ALTER TABLE PARTSUPP
ADD PRIMARY KEY (PS_PARTKEY,PS_SUPPKEY);

ALTER TABLE CUSTOMER ALTER COLUMN C_CUSTKEY INT NOT NULL;
GO
ALTER TABLE CUSTOMER
ADD PRIMARY KEY (C_CUSTKEY);

ALTER TABLE CUSTOMER
ADD CONSTRAINT CUSTOMER_FK1 FOREIGN KEY (C_NATIONKEY) REFERENCES NATION(N_NATIONKEY);

ALTER TABLE LINEITEM ALTER COLUMN L_ORDERKEY BIGINT NOT NULL;
ALTER TABLE LINEITEM ALTER COLUMN L_LINENUMBER INT NOT NULL;
GO
ALTER TABLE LINEITEM
ADD PRIMARY KEY (L_ORDERKEY,L_LINENUMBER);

ALTER TABLE ORDERS ALTER COLUMN O_ORDERKEY BIGINT NOT NULL;
GO
ALTER TABLE ORDERS ADD PRIMARY KEY (O_ORDERKEY);

ALTER TABLE PARTSUPP
ADD CONSTRAINT PARTSUPP_FK1 FOREIGN KEY (PS_SUPPKEY) REFERENCES SUPPLIER(S_SUPPKEY);

ALTER TABLE PARTSUPP
ADD CONSTRAINT PARTSUPP_FK2 FOREIGN KEY (PS_PARTKEY) REFERENCES PART(P_PARTKEY);

ALTER TABLE ORDERS
ADD CONSTRAINT ORDERS_FK1 FOREIGN KEY (O_CUSTKEY) REFERENCES CUSTOMER(C_CUSTKEY);

ALTER TABLE LINEITEM
ADD CONSTRAINT LINEITEM_FK1 FOREIGN KEY (L_ORDERKEY)  REFERENCES ORDERS(O_ORDERKEY);

ALTER TABLE LINEITEM
ADD CONSTRAINT LINEITEM_FK2 FOREIGN KEY (L_PARTKEY,L_SUPPKEY) REFERENCES PARTSUPP(PS_PARTKEY, PS_SUPPKEY);
GO
